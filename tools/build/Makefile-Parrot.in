# Copyright (C) 2006-2013, The Perl Foundation.
# $Id$

SHELL            = @shell@
PARROT_ARGS      = -L. -X.

# values from parrot_config
PARROT_BIN_DIR     = @@bindir@@
PARROT_LIB_SHARED  = @@libparrot_shared@@
PARROT_VERSION     = @@versiondir@@
PARROT_INCLUDE_DIR = @@includedir@@$(PARROT_VERSION)
PARROT_LIB_DIR     = @@libdir@@$(PARROT_VERSION)
PARROT_SRC_DIR     = @@srcdir@@$(PARROT_VERSION)
PARROT_LIBRARY_DIR = $(PARROT_LIB_DIR)/library
NQP_LANG_DIR       = $(PARROT_LIB_DIR)/languages/nqp
HAS_ICU            = @has_icu@

PARROT_BUILD_DIR   = gen/parrot

CC            = @cc@
CFLAGS        = @ccflags@ @cc_shared@ @cc_debug@ @ccwarn@ @gc_flag@ @optimize@
EXE           = @exe@
LD            = @ld@
LDFLAGS       = @ldflags@ @ld_debug@
LD_LOAD_FLAGS = @ld_load_flags@
LIBPARROT     = @inst_libparrot_ldflags@
O             = @o@
A             = @a@
LOAD_EXT      = @load_ext@
PERL          = @perl@
CP            = @cp@
MV            = @mv@
RM_F          = @rm_f@
MKPATH        = $(PERL) -MExtUtils::Command -e mkpath
CHMOD         = $(PERL) -MExtUtils::Command -e chmod
TOM           = 3rdparty/libtommath/bn
DYNCALLINC    =

# locations of parrot resources
PARROT            = $(PARROT_BIN_DIR)/parrot$(EXE) $(PARROT_ARGS)
PARROT_DLL        = @dll@
PARROT_DLL_COPY   = @dllcopy@
PARROT_NQP        = $(PARROT_BIN_DIR)/parrot_nqp$(EXE)
PBC_TO_EXE        = $(PARROT_BIN_DIR)/pbc_to_exe$(EXE)
PARROT_TOOLS_DIR  = $(PARROT_LIB_DIR)/tools
PARROT_PERL_LIB   = $(PARROT_TOOLS_DIR)/lib
OPS2C             = $(PARROT_BIN_DIR)/ops2c$(EXE)
PMC2C             = $(PERL) $(PARROT_TOOLS_DIR)/build/pmc2c.pl
PMC2C_INCLUDES    = --include src/pmc --include $(PARROT_SRC_DIR) --include $(PARROT_SRC_DIR)/pmc
CINCLUDES         = -I$(PARROT_INCLUDE_DIR) -I$(PARROT_INCLUDE_DIR)/pmc
LINKARGS          = $(LDFLAGS) $(LD_LOAD_FLAGS) $(LIBPARROT) @libs@ @icu_shared@

# nqp directories
DYNEXT_DIR       = dynext
PMC_DIR          = src/vm/parrot/pmc
OPS_DIR          = src/vm/parrot/ops

HLL_SOURCES = \
  src/HLL/Grammar.nqp \
  src/HLL/Actions.nqp \
  src/vm/parrot/HLL/Backend.nqp \
  src/HLL/Compiler.nqp \
  src/HLL/CommandLine.nqp \
  src/HLL/World.nqp \
  src/HLL/sprintf.nqp \

QASTNODE_COMBINED = QASTNode.nqp
QASTNODE_PIR = QASTNode.pir
QASTNODE_PBC = QASTNode.pbc
QASTNODE_SOURCES = \
  src/QAST/CompileTimeValue.nqp \
  src/QAST/SpecialArg.nqp \
  src/QAST/Node.nqp \
  src/QAST/Regex.nqp \
  src/QAST/IVal.nqp \
  src/QAST/NVal.nqp \
  src/QAST/SVal.nqp \
  src/QAST/BVal.nqp \
  src/QAST/WVal.nqp \
  src/QAST/Want.nqp \
  src/QAST/Var.nqp \
  src/QAST/VarWithFallback.nqp \
  src/QAST/Op.nqp \
  src/QAST/VM.nqp \
  src/QAST/Stmts.nqp \
  src/QAST/Stmt.nqp \
  src/QAST/Block.nqp \
  src/QAST/Unquote.nqp \
  src/QAST/CompUnit.nqp \
  src/QAST/InlinePlaceholder.nqp \

QAST_COMBINED = QAST.nqp
QAST_PIR = QAST.pir
QAST_PBC = QAST.pbc
QAST_SOURCES = \
  src/vm/parrot/QAST/PIRT.nqp \
  src/vm/parrot/QAST/Operations.nqp \
  src/vm/parrot/QAST/Compiler.nqp \

P6QREGEX_SOURCES = \
  src/QRegex/P6Regex/Grammar.nqp \
  src/QRegex/P6Regex/Actions.nqp \
  src/QRegex/P6Regex/Compiler.nqp \

P5QREGEX_SOURCES = \
  src/QRegex/P5Regex/Grammar.nqp \
  src/QRegex/P5Regex/Actions.nqp \
  src/QRegex/P5Regex/Compiler.nqp \

QREGEX_COMBINED = QRegex.nqp
QREGEX_PIR = QRegex.pir
QREGEX_PBC = QRegex.pbc
QREGEX_SOURCES = \
  src/QRegex/NFA.nqp \
  src/QRegex/Cursor.nqp \

CORE_SETTING_SOURCES = \
  src/core/NativeTypes.nqp \
  src/core/NQPRoutine.nqp \
  src/core/NQPMu.nqp \
  src/core/NQPCapture.nqp \
  src/core/IO.nqp \
  src/core/Regex.nqp \
  src/core/Hash.nqp \
  src/core/testing.nqp \
  src/core/YOUAREHERE.nqp \

CORE_SETTING_NQP = NQPCORE.setting

STAGE0_SOURCES = \
	src/vm/parrot/stage0/NQPMO-s0.pir \
	src/vm/parrot/stage0/ModuleLoader-s0.pir \
	src/vm/parrot/stage0/NQPCORE.setting-s0.pir \
	src/vm/parrot/stage0/QASTNode-s0.pir \
	src/vm/parrot/stage0/QRegex-s0.pir \
	src/vm/parrot/stage0/HLL-s0.pir \
	src/vm/parrot/stage0/QAST-s0.pir \
	src/vm/parrot/stage0/P6QRegex-s0.pir \
	src/vm/parrot/stage0/NQP-s0.pir

STAGE0 = src/vm/parrot/stage0
STAGE1 = $(PARROT_BUILD_DIR)/stage1
STAGE2 = $(PARROT_BUILD_DIR)/stage2

MODULE_LOADER_PBC = ModuleLoader.pbc

REGEX_PBC       = NQPRegex.pbc

HLL_PBC          = NQPHLL.pbc
HLL_COMBINED     = gen/NQPHLL.nqp
HLL_COMBINED_PIR = gen/NQPHLL.pir

P6REGEX_PBC          = NQPP6Regex.pbc
P6REGEX_COMBINED     = gen/NQPP6Regex.nqp
P6REGEX_COMBINED_PIR = gen/NQPP6Regex.pir

P6QREGEX_PBC          = NQPP6QRegex.pbc
P6QREGEX_COMBINED     = gen/NQPP6QRegex.nqp
P6QREGEX_COMBINED_PIR = gen/NQPP6QRegex.pir

P5QREGEX_PBC          = $(PARROT_BUILD_DIR)/NQPP5QRegex.pbc
P5QREGEX_COMBINED     = $(PARROT_BUILD_DIR)/NQPP5QRegex.nqp
P5QREGEX_COMBINED_PIR = $(PARROT_BUILD_DIR)/NQPP5QRegex.pir

NQP_COMBINED     = gen/NQP.nqp
NQP_COMBINED_PIR = gen/NQP.pir
NQP_PBC          = nqp.pbc
NQP_EXE          = nqp-p$(EXE)

NQP_SOURCES = \
  src/NQP/World.nqp \
  src/NQP/Grammar.nqp \
  src/vm/parrot/NQP/Ops.nqp \
  src/NQP/Actions.nqp \
  src/NQP/Optimizer.nqp \
  src/NQP/Compiler.nqp \

NQP_MO_SOURCES = src/how/Archetypes.nqp src/how/RoleToRoleApplier.nqp \
                 src/how/NQPConcreteRoleHOW.nqp src/how/RoleToClassApplier.nqp \
                 src/how/NQPCurriedRoleHOW.nqp src/how/NQPParametricRoleHOW.nqp \
                 src/how/NQPClassHOW.nqp src/how/NQPNativeHOW.nqp \
                 src/how/NQPAttribute.nqp src/how/NQPModuleHOW.nqp \
                 src/how/EXPORTHOW.nqp \

NQP_MO_PBC      = nqpmo.pbc
NQP_MO_PIR      = gen/nqp-mo.pir
NQP_MO_COMBINED = gen/nqp-mo.nqp

CORE_SETTING_PBC = NQPCORE.setting.pbc
CORE_SETTING_PIR = gen/NQPCORE.setting.pir

STAGE0_PBCS     = $(STAGE0)/$(NQP_MO_PBC) $(STAGE0)/$(MODULE_LOADER_PBC) $(STAGE0)/$(CORE_SETTING_PBC) $(STAGE0)/$(QASTNODE_PBC) $(STAGE0)/$(QREGEX_PBC) $(STAGE0)/$(HLL_PBC) $(STAGE0)/$(QAST_PBC) $(STAGE0)/$(P6QREGEX_PBC) $(STAGE0)/$(NQP_PBC)
STAGE1_PBCS     = $(STAGE1)/$(NQP_MO_PBC) $(STAGE1)/$(MODULE_LOADER_PBC) $(STAGE1)/$(CORE_SETTING_PBC) $(STAGE1)/$(QASTNODE_PBC) $(STAGE1)/$(QREGEX_PBC) $(STAGE1)/$(HLL_PBC) $(STAGE1)/$(QAST_PBC) $(STAGE1)/$(P6QREGEX_PBC) $(STAGE1)/$(NQP_PBC)
STAGE2_PBCS     = $(STAGE2)/$(NQP_MO_PBC) $(STAGE2)/$(MODULE_LOADER_PBC) $(STAGE2)/$(CORE_SETTING_PBC) $(STAGE2)/$(QASTNODE_PBC) $(STAGE2)/$(QREGEX_PBC) $(STAGE2)/$(HLL_PBC) $(STAGE2)/$(QAST_PBC) $(STAGE2)/$(P6QREGEX_PBC) $(STAGE2)/$(NQP_PBC)
ALL_PBCS        = $(PARROT_BUILD_DIR)/$(NQP_MO_PBC) $(PARROT_BUILD_DIR)/$(MODULE_LOADER_PBC) $(PARROT_BUILD_DIR)/$(CORE_SETTING_PBC) $(PARROT_BUILD_DIR)/$(QASTNODE_PBC) $(PARROT_BUILD_DIR)/$(QREGEX_PBC) $(PARROT_BUILD_DIR)/$(HLL_PBC) $(PARROT_BUILD_DIR)/$(QAST_PBC) $(PARROT_BUILD_DIR)/$(P6QREGEX_PBC) $(PARROT_BUILD_DIR)/$(NQP_PBC)

GROUP           = nqp_group
OPS             = nqp_ops
DYNEXT_TARGET   = $(DYNEXT_DIR)/$(GROUP)$(LOAD_EXT)
DYNPMC          = $(PMC_DIR)/$(GROUP)$(LOAD_EXT)
DYNOPS          = $(OPS_DIR)/$(OPS)$(LOAD_EXT)

PMC_SOURCES     = $(PMC_DIR)/stable.pmc $(PMC_DIR)/sixmodelobject.pmc \
                  $(PMC_DIR)/nqplexinfo.pmc $(PMC_DIR)/nqplexpad.pmc \
                  $(PMC_DIR)/serializationcontext.pmc $(PMC_DIR)/ownedhash.pmc \
                  $(PMC_DIR)/ownedresizablepmcarray.pmc $(PMC_DIR)/qrpa.pmc

DYNPMC_HEADERS  = $(PMC_DIR)/pmc_stable.h $(PMC_DIR)/pmc_sixmodelobject.h \
                  $(PMC_DIR)/pmc_nqplexinfo.h $(PMC_DIR)/pmc_nqplexpad.h \
                  $(PMC_DIR)/pmc_serializationcontext.h $(PMC_DIR)/pmc_ownedhash.h \
                  $(PMC_DIR)/pmc_ownedresizablepmcarray.h $(PMC_DIR)/pmc_qrpa.h

OPS_SOURCE      = nqp.ops

METAMODEL_SOURCE = src/vm/parrot/6model/sixmodelobject.h src/vm/parrot/6model/sixmodelobject.c \
                   src/vm/parrot/6model/repr_registry.h src/vm/parrot/6model/repr_registry.c \
                   src/vm/parrot/6model/knowhow_bootstrapper.h src/vm/parrot/6model/knowhow_bootstrapper.c \
                   src/vm/parrot/6model/reprs/KnowHOWREPR.h src/vm/parrot/6model/reprs/KnowHOWREPR.c \
                   src/vm/parrot/6model/reprs/P6opaque.h src/vm/parrot/6model/reprs/P6opaque.c \
                   src/vm/parrot/6model/reprs/P6int.h src/vm/parrot/6model/reprs/P6int.c \
                   src/vm/parrot/6model/reprs/P6str.h src/vm/parrot/6model/reprs/P6str.c \
                   src/vm/parrot/6model/reprs/P6num.h src/vm/parrot/6model/reprs/P6num.c \
                   src/vm/parrot/6model/reprs/HashAttrStore.h src/vm/parrot/6model/reprs/HashAttrStore.c \
                   src/vm/parrot/6model/reprs/Uninstantiable.h src/vm/parrot/6model/reprs/Uninstantiable.c \
                   src/vm/parrot/6model/reprs/NFA.h src/vm/parrot/6model/reprs/NFA.c \
                   src/vm/parrot/6model/reprs/VMArray.h src/vm/parrot/6model/reprs/VMArray.c \
                   src/vm/parrot/6model/reprs/VMHash.h src/vm/parrot/6model/reprs/VMHash.c \
                   src/vm/parrot/6model/reprs/VMIter.h src/vm/parrot/6model/reprs/VMIter.c \
                   src/vm/parrot/6model/storage_spec.h src/vm/parrot/6model/serialization_context.c \
                   src/vm/parrot/6model/serialization_context.h src/vm/parrot/6model/serialization.c \
                   src/vm/parrot/6model/serialization.h src/vm/parrot/guts/multi_dispatch.h \
                   src/vm/parrot/guts/multi_dispatch.c src/vm/parrot/6model/base64.c src/vm/parrot/6model/base64.h \
                   src/vm/parrot/6model/containers.c src/vm/parrot/6model/containers.h \

METAMODEL_OBJS   = ../6model/sixmodelobject$(O) ../6model/repr_registry$(O) \
                   ../6model/knowhow_bootstrapper$(O) ../6model/reprs/KnowHOWREPR$(O) \
                   ../6model/reprs/P6opaque$(O) ../6model/reprs/P6int$(O) \
                   ../6model/reprs/P6str$(O) ../6model/reprs/P6num$(O) \
                   ../6model/reprs/HashAttrStore$(O) ../6model/reprs/Uninstantiable$(O) \
                   ../6model/reprs/NFA$(O) ../6model/reprs/VMArray$(O) \
                   ../6model/reprs/VMHash$(O) ../6model/reprs/VMIter$(O) \
                   ../6model/serialization_context$(O) ../6model/base64$(O) \
                   ../6model/serialization$(O) ../guts/multi_dispatch$(O) \
                   ../6model/containers$(O) \

LIBTOMMATH_BIN = $(TOM)core$(O) \
        $(TOM)_error$(O) \
        $(TOM)_fast_mp_invmod$(O) \
        $(TOM)_fast_mp_montgomery_reduce$(O) \
        $(TOM)_fast_s_mp_mul_digs$(O) \
        $(TOM)_fast_s_mp_mul_high_digs$(O) \
        $(TOM)_fast_s_mp_sqr$(O) \
        $(TOM)_mp_2expt$(O) \
        $(TOM)_mp_abs$(O) \
        $(TOM)_mp_add_d$(O) \
        $(TOM)_mp_addmod$(O) \
        $(TOM)_mp_add$(O) \
        $(TOM)_mp_and$(O) \
        $(TOM)_mp_clamp$(O) \
        $(TOM)_mp_clear_multi$(O) \
        $(TOM)_mp_clear$(O) \
        $(TOM)_mp_cmp_d$(O) \
        $(TOM)_mp_cmp_mag$(O) \
        $(TOM)_mp_cmp$(O) \
        $(TOM)_mp_cnt_lsb$(O) \
        $(TOM)_mp_copy$(O) \
        $(TOM)_mp_count_bits$(O) \
        $(TOM)_mp_div_2d$(O) \
        $(TOM)_mp_div_2$(O) \
        $(TOM)_mp_div_3$(O) \
        $(TOM)_mp_div_d$(O) \
        $(TOM)_mp_div$(O) \
        $(TOM)_mp_dr_is_modulus$(O) \
        $(TOM)_mp_dr_reduce$(O) \
        $(TOM)_mp_dr_setup$(O) \
        $(TOM)_mp_exch$(O) \
        $(TOM)_mp_expt_d$(O) \
        $(TOM)_mp_exptmod_fast$(O) \
        $(TOM)_mp_exptmod$(O) \
        $(TOM)_mp_exteuclid$(O) \
        $(TOM)_mp_fread$(O) \
        $(TOM)_mp_fwrite$(O) \
        $(TOM)_mp_gcd$(O) \
        $(TOM)_mp_get_int$(O) \
        $(TOM)_mp_get_long$(O) \
        $(TOM)_mp_grow$(O) \
        $(TOM)_mp_init_copy$(O) \
        $(TOM)_mp_init_multi$(O) \
        $(TOM)_mp_init$(O) \
        $(TOM)_mp_init_set_int$(O) \
        $(TOM)_mp_init_set$(O) \
        $(TOM)_mp_init_size$(O) \
        $(TOM)_mp_invmod$(O) \
        $(TOM)_mp_invmod_slow$(O) \
        $(TOM)_mp_is_square$(O) \
        $(TOM)_mp_jacobi$(O) \
        $(TOM)_mp_karatsuba_mul$(O) \
        $(TOM)_mp_karatsuba_sqr$(O) \
        $(TOM)_mp_lcm$(O) \
        $(TOM)_mp_lshd$(O) \
        $(TOM)_mp_mod_2d$(O) \
        $(TOM)_mp_mod_d$(O) \
        $(TOM)_mp_mod$(O) \
        $(TOM)_mp_montgomery_calc_normalization$(O) \
        $(TOM)_mp_montgomery_reduce$(O) \
        $(TOM)_mp_montgomery_setup$(O) \
        $(TOM)_mp_mul_2d$(O) \
        $(TOM)_mp_mul_2$(O) \
        $(TOM)_mp_mul_d$(O) \
        $(TOM)_mp_mulmod$(O) \
        $(TOM)_mp_mul$(O) \
        $(TOM)_mp_neg$(O) \
        $(TOM)_mp_n_root$(O) \
        $(TOM)_mp_or$(O) \
        $(TOM)_mp_prime_fermat$(O) \
        $(TOM)_mp_prime_is_divisible$(O) \
        $(TOM)_mp_prime_is_prime$(O) \
        $(TOM)_mp_prime_miller_rabin$(O) \
        $(TOM)_mp_prime_next_prime$(O) \
        $(TOM)_mp_prime_rabin_miller_trials$(O) \
        $(TOM)_mp_prime_random_ex$(O) \
        $(TOM)_mp_radix_size$(O) \
        $(TOM)_mp_radix_smap$(O) \
        $(TOM)_mp_rand$(O) \
        $(TOM)_mp_read_radix$(O) \
        $(TOM)_mp_read_signed_bin$(O) \
        $(TOM)_mp_read_unsigned_bin$(O) \
        $(TOM)_mp_reduce_2k_l$(O) \
        $(TOM)_mp_reduce_2k$(O) \
        $(TOM)_mp_reduce_2k_setup_l$(O) \
        $(TOM)_mp_reduce_2k_setup$(O) \
        $(TOM)_mp_reduce_is_2k_l$(O) \
        $(TOM)_mp_reduce_is_2k$(O) \
        $(TOM)_mp_reduce$(O) \
        $(TOM)_mp_reduce_setup$(O) \
        $(TOM)_mp_rshd$(O) \
        $(TOM)_mp_set_int$(O) \
        $(TOM)_mp_set_long$(O) \
        $(TOM)_mp_set$(O) \
        $(TOM)_mp_shrink$(O) \
        $(TOM)_mp_signed_bin_size$(O) \
        $(TOM)_mp_sqrmod$(O) \
        $(TOM)_mp_sqr$(O) \
        $(TOM)_mp_sqrt$(O) \
        $(TOM)_mp_sub_d$(O) \
        $(TOM)_mp_submod$(O) \
        $(TOM)_mp_sub$(O) \
        $(TOM)_mp_toom_mul$(O) \
        $(TOM)_mp_toom_sqr$(O) \
        $(TOM)_mp_toradix_n$(O) \
        $(TOM)_mp_toradix$(O) \
        $(TOM)_mp_to_signed_bin_n$(O) \
        $(TOM)_mp_to_signed_bin$(O) \
        $(TOM)_mp_to_unsigned_bin_n$(O) \
        $(TOM)_mp_to_unsigned_bin$(O) \
        $(TOM)_mp_unsigned_bin_size$(O) \
        $(TOM)_mp_xor$(O) \
        $(TOM)_mp_zero$(O) \
        $(TOM)_prime_tab$(O) \
        $(TOM)_reverse$(O) \
        $(TOM)_s_mp_add$(O) \
        $(TOM)_s_mp_exptmod$(O) \
        $(TOM)_s_mp_mul_digs$(O) \
        $(TOM)_s_mp_mul_high_digs$(O) \
        $(TOM)_s_mp_sqr$(O) \
        $(TOM)_s_mp_sub$(O)

LIBTOMMATH_H =  3rdparty/libtommath/tommath_class.h \
	3rdparty/libtommath/tommath.h \
	3rdparty/libtommath/tommath_superclass.h \

LIBTOMMATH_SOURCE =	3rdparty/libtommath/bncore.c \
	3rdparty/libtommath/bn_error.c \
	3rdparty/libtommath/bn_fast_mp_invmod.c \
	3rdparty/libtommath/bn_fast_mp_montgomery_reduce.c \
	3rdparty/libtommath/bn_fast_s_mp_mul_digs.c \
	3rdparty/libtommath/bn_fast_s_mp_mul_high_digs.c \
	3rdparty/libtommath/bn_fast_s_mp_sqr.c \
	3rdparty/libtommath/bn_mp_2expt.c \
	3rdparty/libtommath/bn_mp_abs.c \
	3rdparty/libtommath/bn_mp_add.c \
	3rdparty/libtommath/bn_mp_add_d.c \
	3rdparty/libtommath/bn_mp_addmod.c \
	3rdparty/libtommath/bn_mp_and.c \
	3rdparty/libtommath/bn_mp_clamp.c \
	3rdparty/libtommath/bn_mp_clear.c \
	3rdparty/libtommath/bn_mp_clear_multi.c \
	3rdparty/libtommath/bn_mp_cmp.c \
	3rdparty/libtommath/bn_mp_cmp_d.c \
	3rdparty/libtommath/bn_mp_cmp_mag.c \
	3rdparty/libtommath/bn_mp_cnt_lsb.c \
	3rdparty/libtommath/bn_mp_copy.c \
	3rdparty/libtommath/bn_mp_count_bits.c \
	3rdparty/libtommath/bn_mp_div_2.c \
	3rdparty/libtommath/bn_mp_div_2d.c \
	3rdparty/libtommath/bn_mp_div_3.c \
	3rdparty/libtommath/bn_mp_div.c \
	3rdparty/libtommath/bn_mp_div_d.c \
	3rdparty/libtommath/bn_mp_dr_is_modulus.c \
	3rdparty/libtommath/bn_mp_dr_reduce.c \
	3rdparty/libtommath/bn_mp_dr_setup.c \
	3rdparty/libtommath/bn_mp_exch.c \
	3rdparty/libtommath/bn_mp_expt_d.c \
	3rdparty/libtommath/bn_mp_exptmod.c \
	3rdparty/libtommath/bn_mp_exptmod_fast.c \
	3rdparty/libtommath/bn_mp_exteuclid.c \
	3rdparty/libtommath/bn_mp_fread.c \
	3rdparty/libtommath/bn_mp_fwrite.c \
	3rdparty/libtommath/bn_mp_gcd.c \
	3rdparty/libtommath/bn_mp_get_int.c \
	3rdparty/libtommath/bn_mp_get_long.c \
	3rdparty/libtommath/bn_mp_grow.c \
	3rdparty/libtommath/bn_mp_init.c \
	3rdparty/libtommath/bn_mp_init_copy.c \
	3rdparty/libtommath/bn_mp_init_multi.c \
	3rdparty/libtommath/bn_mp_init_set.c \
	3rdparty/libtommath/bn_mp_init_set_int.c \
	3rdparty/libtommath/bn_mp_init_size.c \
	3rdparty/libtommath/bn_mp_invmod.c \
	3rdparty/libtommath/bn_mp_invmod_slow.c \
	3rdparty/libtommath/bn_mp_is_square.c \
	3rdparty/libtommath/bn_mp_jacobi.c \
	3rdparty/libtommath/bn_mp_karatsuba_mul.c \
	3rdparty/libtommath/bn_mp_karatsuba_sqr.c \
	3rdparty/libtommath/bn_mp_lcm.c \
	3rdparty/libtommath/bn_mp_lshd.c \
	3rdparty/libtommath/bn_mp_mod_2d.c \
	3rdparty/libtommath/bn_mp_mod.c \
	3rdparty/libtommath/bn_mp_mod_d.c \
	3rdparty/libtommath/bn_mp_montgomery_calc_normalization.c \
	3rdparty/libtommath/bn_mp_montgomery_reduce.c \
	3rdparty/libtommath/bn_mp_montgomery_setup.c \
	3rdparty/libtommath/bn_mp_mul_2.c \
	3rdparty/libtommath/bn_mp_mul_2d.c \
	3rdparty/libtommath/bn_mp_mul.c \
	3rdparty/libtommath/bn_mp_mul_d.c \
	3rdparty/libtommath/bn_mp_mulmod.c \
	3rdparty/libtommath/bn_mp_neg.c \
	3rdparty/libtommath/bn_mp_n_root.c \
	3rdparty/libtommath/bn_mp_or.c \
	3rdparty/libtommath/bn_mp_prime_fermat.c \
	3rdparty/libtommath/bn_mp_prime_is_divisible.c \
	3rdparty/libtommath/bn_mp_prime_is_prime.c \
	3rdparty/libtommath/bn_mp_prime_miller_rabin.c \
	3rdparty/libtommath/bn_mp_prime_next_prime.c \
	3rdparty/libtommath/bn_mp_prime_rabin_miller_trials.c \
	3rdparty/libtommath/bn_mp_prime_random_ex.c \
	3rdparty/libtommath/bn_mp_radix_size.c \
	3rdparty/libtommath/bn_mp_radix_smap.c \
	3rdparty/libtommath/bn_mp_rand.c \
	3rdparty/libtommath/bn_mp_read_radix.c \
	3rdparty/libtommath/bn_mp_read_signed_bin.c \
	3rdparty/libtommath/bn_mp_read_unsigned_bin.c \
	3rdparty/libtommath/bn_mp_reduce_2k.c \
	3rdparty/libtommath/bn_mp_reduce_2k_l.c \
	3rdparty/libtommath/bn_mp_reduce_2k_setup.c \
	3rdparty/libtommath/bn_mp_reduce_2k_setup_l.c \
	3rdparty/libtommath/bn_mp_reduce.c \
	3rdparty/libtommath/bn_mp_reduce_is_2k.c \
	3rdparty/libtommath/bn_mp_reduce_is_2k_l.c \
	3rdparty/libtommath/bn_mp_reduce_setup.c \
	3rdparty/libtommath/bn_mp_rshd.c \
	3rdparty/libtommath/bn_mp_set.c \
	3rdparty/libtommath/bn_mp_set_int.c \
	3rdparty/libtommath/bn_mp_set_long.c \
	3rdparty/libtommath/bn_mp_shrink.c \
	3rdparty/libtommath/bn_mp_signed_bin_size.c \
	3rdparty/libtommath/bn_mp_sqr.c \
	3rdparty/libtommath/bn_mp_sqrmod.c \
	3rdparty/libtommath/bn_mp_sqrt.c \
	3rdparty/libtommath/bn_mp_sub.c \
	3rdparty/libtommath/bn_mp_sub_d.c \
	3rdparty/libtommath/bn_mp_submod.c \
	3rdparty/libtommath/bn_mp_toom_mul.c \
	3rdparty/libtommath/bn_mp_toom_sqr.c \
	3rdparty/libtommath/bn_mp_toradix.c \
	3rdparty/libtommath/bn_mp_toradix_n.c \
	3rdparty/libtommath/bn_mp_to_signed_bin.c \
	3rdparty/libtommath/bn_mp_to_signed_bin_n.c \
	3rdparty/libtommath/bn_mp_to_unsigned_bin.c \
	3rdparty/libtommath/bn_mp_to_unsigned_bin_n.c \
	3rdparty/libtommath/bn_mp_unsigned_bin_size.c \
	3rdparty/libtommath/bn_mp_xor.c \
	3rdparty/libtommath/bn_mp_zero.c \
	3rdparty/libtommath/bn_prime_tab.c \
	3rdparty/libtommath/bn_reverse.c \
	3rdparty/libtommath/bn_s_mp_add.c \
	3rdparty/libtommath/bn_s_mp_exptmod.c \
	3rdparty/libtommath/bn_s_mp_mul_digs.c \
	3rdparty/libtommath/bn_s_mp_mul_high_digs.c \
	3rdparty/libtommath/bn_s_mp_sqr.c \
	3rdparty/libtommath/bn_s_mp_sub.c \

BIGINT_OPS        = nqp_bigint_ops
BIGINT_OPS_SOURCE = nqp_bigint.ops

DYNCALL_BIN = 3rdparty/dyncall/dyncall/libdyncall_s$(A) \
  3rdparty/dyncall/dyncallback/libdyncallback_s$(A) \
  3rdparty/dyncall/dynload/libdynload_s$(A)

DYNCALL_OPS        = nqp_dyncall_ops
DYNCALL_OPS_SOURCE = nqp_dyncall.ops

NQP_CONST_PIR = nqp_const.pir

CLEANUPS = \
  *.manifest \
  *.pdb \
  $(REGEX_PBC) \
  $(HLL_PBC) \
  $(P6REGEX_PBC) \
  $(NQP_MO_PBC) \
  $(CORE_SETTING_PBC) \
  $(MODULE_LOADER_PBC) \
  P6Regex$(EXE) \
  nqp.pbc \
  nqp$(EXE) \
  $(PARROT_DLL_COPY) \
  *.c\
  *.o\
  src/vm/parrot/stage0/*.pbc \
  src/stage1/gen/* \
  src/stage1/*.pbc \
  src/stage2/gen/* \
  src/stage2/*.pbc \
  src/gen/*.pir \
  src/gen/*.nqp \
  src/gen/*.nqp \
  $(PMC_DIR)/pmc_*.h \
  $(PMC_DIR)/*.c \
  $(PMC_DIR)/*.dump \
  $(PMC_DIR)/*$(O) \
  $(PMC_DIR)/*$(LOAD_EXT) \
  $(PMC_DIR)/*.exp \
  $(PMC_DIR)/*.ilk \
  $(PMC_DIR)/*.manifest \
  $(PMC_DIR)/*.pdb \
  $(PMC_DIR)/*.lib \
  $(PMC_DIR)/objectref.pmc \
  $(OPS_DIR)/*.h \
  $(OPS_DIR)/*.c \
  $(OPS_DIR)/*$(O) \
  $(OPS_DIR)/*$(LOAD_EXT) \
  $(OPS_DIR)/*.exp \
  $(OPS_DIR)/*.lib \
  $(OPS_DIR)/*.pdb \
  3rdparty/libtommath/*$(O) \
  3rdparty/sha1/*$(O) \
  $(DYNEXT_DIR)/*$(LOAD_EXT) \
  $(NQP_CONST_PIR) \
  src/vm/parrot/guts/*$(O) \
  src/vm/parrot/guts/*.pdb \
  src/vm/parrot/6model/*$(O) \
  src/vm/parrot/6model/*.pdb \
  src/vm/parrot/6model/reprs/*$(O) \
  src/vm/parrot/6model/reprs/*.pdb \

all: $(PARROT_BUILD_DIR)/$(NQP_EXE) $(P5QREGEX_PBC)

install: all
	$(MKPATH)                   $(DESTDIR)$(PARROT_LIBRARY_DIR)
	$(MKPATH)                   $(DESTDIR)$(PARROT_LIB_DIR)/include
	$(CP)  $(PARROT_BIN_DIR)/$(MODULE_LOADER_PBC) $(DESTDIR)$(PARROT_LIBRARY_DIR)/$(MODULE_LOADER_PBC)
	$(CP)  $(NQP_CONST_PIR)     $(DESTDIR)$(PARROT_LIB_DIR)/include/$(NQP_CONST_PIR)
	$(MKPATH)                   $(DESTDIR)$(NQP_LANG_DIR)/lib
	$(CP)  $(QAST_PBC)          $(DESTDIR)$(NQP_LANG_DIR)/lib/$(QAST_PBC)
	$(CP)  $(QASTNODE_PBC)      $(DESTDIR)$(NQP_LANG_DIR)/lib/$(QASTNODE_PBC)
	$(CP)  $(P6QREGEX_PBC)      $(DESTDIR)$(NQP_LANG_DIR)/lib/$(P6QREGEX_PBC)
	$(CP)  $(P5QREGEX_PBC)      $(DESTDIR)$(NQP_LANG_DIR)/lib/$(P5QREGEX_PBC)
	$(CP)  $(PARROT_BIN_DIR)/$(HLL_PBC)           $(DESTDIR)$(NQP_LANG_DIR)/lib/$(HLL_PBC)
	$(CP)  $(PARROT_BIN_DIR)/$(CORE_SETTING_PBC)  $(DESTDIR)$(NQP_LANG_DIR)/lib/$(CORE_SETTING_PBC)
	$(CP)  $(PARROT_BIN_DIR)/$(NQP_MO_PBC)        $(DESTDIR)$(NQP_LANG_DIR)/lib/$(NQP_MO_PBC)
	$(CP)  $(PARROT_BIN_DIR)/$(NQP_PBC)           $(DESTDIR)$(NQP_LANG_DIR)/lib/$(NQP_PBC)
	$(CP)  $(PARROT_BIN_DIR)/$(QREGEX_PBC)        $(DESTDIR)$(NQP_LANG_DIR)/lib/$(QREGEX_PBC)
	$(MKPATH)              $(DESTDIR)$(PARROT_BIN_DIR)
	$(CP)  $(PARROT_BUILD_DIR)/$(NQP_EXE)      $(DESTDIR)$(PARROT_BIN_DIR)/nqp$(EXE)
	$(CHMOD)  755          $(DESTDIR)$(PARROT_BIN_DIR)/nqp$(EXE)
	$(MKPATH)                     $(DESTDIR)$(PARROT_LIB_DIR)/dynext
	$(CP)     $(DYNPMC) $(DYNOPS) $(OPS_DIR)/$(BIGINT_OPS)$(LOAD_EXT) $(OPS_DIR)/$(DYNCALL_OPS)$(LOAD_EXT) $(DESTDIR)$(PARROT_LIB_DIR)/dynext
	$(MKPATH)                     $(DESTDIR)$(PARROT_INCLUDE_DIR)/dynpmc
	$(CP)       $(DYNPMC_HEADERS) $(DESTDIR)$(PARROT_INCLUDE_DIR)/dynpmc

stage0: $(STAGE0)
stage1: $(STAGE1)
stage2: $(STAGE2)

$(STAGE0): $(STAGE0_PBCS)

$(STAGE0_PBCS): $(DYNEXT_TARGET) $(STAGE0_SOURCES)
	$(PARROT) -o $(STAGE0)/$(NQP_MO_PBC)       src/vm/parrot/stage0/NQPMO-s0.pir
	$(PARROT) -o $(STAGE0)/$(MODULE_LOADER_PBC) src/vm/parrot/stage0/ModuleLoader-s0.pir
	$(PARROT) -o $(STAGE0)/$(CORE_SETTING_PBC) src/vm/parrot/stage0/NQPCORE.setting-s0.pir
	$(PARROT) -o $(STAGE0)/$(QASTNODE_PBC)     src/vm/parrot/stage0/QASTNode-s0.pir
	$(PARROT) -o $(STAGE0)/$(QREGEX_PBC)       src/vm/parrot/stage0/QRegex-s0.pir
	$(PARROT) -o $(STAGE0)/$(HLL_PBC)          src/vm/parrot/stage0/HLL-s0.pir
	$(PARROT) -o $(STAGE0)/$(QAST_PBC)         src/vm/parrot/stage0/QAST-s0.pir
	$(PARROT) -o $(STAGE0)/$(P6QREGEX_PBC)     src/vm/parrot/stage0/P6QRegex-s0.pir
	$(PARROT) -o $(STAGE0)/$(NQP_PBC)          src/vm/parrot/stage0/NQP-s0.pir

$(STAGE1): $(STAGE1_PBCS)

$(STAGE1)/$(NQP_MO_PBC): $(NQP_CONST_PIR) $(STAGE0_PBCS) $(NQP_MO_SOURCES)
	$(MKPATH) $(STAGE1)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(NQP_MO_SOURCES) > $(STAGE1)/$(NQP_MO_COMBINED)
	$(PARROT) --library=$(STAGE0) $(STAGE0)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE1)/$(NQP_MO_PIR) \
	    --setting=NULL --no-regex-lib $(STAGE1)/$(NQP_MO_COMBINED)
	$(PARROT) --include=$(STAGE1) -o $(STAGE1)/$(NQP_MO_PBC) \
	    $(STAGE1)/$(NQP_MO_PIR)

$(STAGE1)/$(MODULE_LOADER_PBC): $(STAGE0_PBCS) src/vm/parrot/ModuleLoader.nqp
	$(PARROT) --library=$(STAGE0) $(STAGE0)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE1)/gen/module_loader.pir \
	    --setting=NULL --no-regex-lib src/vm/parrot/ModuleLoader.nqp
	$(PARROT) --include=$(STAGE1) -o $(STAGE1)/$(MODULE_LOADER_PBC) \
	    $(STAGE1)/gen/module_loader.pir

$(STAGE1)/$(CORE_SETTING_PBC): $(STAGE0_PBCS) $(STAGE1)/$(NQP_MO_PBC) $(STAGE1)/$(MODULE_LOADER_PBC) $(CORE_SETTING_SOURCES)
	$(MKPATH) $(STAGE1)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(CORE_SETTING_SOURCES) > $(STAGE1)/$(CORE_SETTING_NQP)
	$(PARROT) --library=$(STAGE0) $(STAGE0)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE1)/$(CORE_SETTING_PIR) \
	    --module-path=$(STAGE1) --setting=NULL --no-regex-lib \
        $(STAGE1)/$(CORE_SETTING_NQP)
	$(PARROT) -o $(STAGE1)/$(CORE_SETTING_PBC) $(STAGE1)/$(CORE_SETTING_PIR)

$(STAGE1)/$(QASTNODE_PBC): $(STAGE0_PBCS) $(STAGE1)/$(CORE_SETTING_PBC) $(QASTNODE_SOURCES)
	$(MKPATH) $(STAGE1)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(QASTNODE_SOURCES) > $(STAGE1)/$(QASTNODE_COMBINED)
	$(PARROT) --library=$(STAGE0) $(STAGE0)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE1)/$(QASTNODE_PIR) \
	    --module-path=$(STAGE1) --setting-path=$(STAGE1) --no-regex-lib \
        $(STAGE1)/$(QASTNODE_COMBINED)
	$(PARROT) -o $(STAGE1)/$(QASTNODE_PBC) $(STAGE1)/$(QASTNODE_PIR)

$(STAGE1)/$(QREGEX_PBC): $(STAGE0_PBCS) $(STAGE1)/$(CORE_SETTING_PBC) $(STAGE1)/$(QASTNODE_PBC) $(QREGEX_SOURCES)
	$(MKPATH) $(STAGE1)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(QREGEX_SOURCES) > $(STAGE1)/$(QREGEX_COMBINED)
	$(PARROT) --library=$(STAGE0) $(STAGE0)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE1)/$(QREGEX_PIR) \
	    --module-path=$(STAGE1) --setting-path=$(STAGE1) --no-regex-lib \
        $(STAGE1)/$(QREGEX_COMBINED)
	$(PARROT) -o $(STAGE1)/$(QREGEX_PBC) $(STAGE1)/$(QREGEX_PIR)

$(STAGE1)/$(HLL_PBC): $(STAGE0_PBCS) $(STAGE1)/$(QREGEX_PBC) $(STAGE1)/$(QASTNODE_PBC) $(STAGE1)/$(CORE_SETTING_PBC) $(HLL_SOURCES)
	$(MKPATH) $(STAGE1)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(HLL_SOURCES) > $(STAGE1)/$(HLL_COMBINED)
	$(PARROT) --library=$(STAGE0) $(STAGE0)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE1)/$(HLL_COMBINED_PIR) \
	    --module-path=$(STAGE1) --setting-path=$(STAGE1) --no-regex-lib \
        $(STAGE1)/$(HLL_COMBINED)
	$(PARROT) --include=$(STAGE1) -o $(STAGE1)/$(HLL_PBC) \
	    $(STAGE1)/$(HLL_COMBINED_PIR)

$(STAGE1)/$(QAST_PBC): $(STAGE0_PBCS) $(STAGE1)/$(CORE_SETTING_PBC) $(STAGE1)/$(HLL_PBC) $(QAST_SOURCES)
	$(MKPATH) $(STAGE1)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(QAST_SOURCES) > $(STAGE1)/$(QAST_COMBINED)
	$(PARROT) --library=$(STAGE0) $(STAGE0)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE1)/$(QAST_PIR) \
	    --module-path=$(STAGE1) --setting-path=$(STAGE1) --no-regex-lib \
        $(STAGE1)/$(QAST_COMBINED)
	$(PARROT) -o $(STAGE1)/$(QAST_PBC) $(STAGE1)/$(QAST_PIR)

$(STAGE1)/$(P6QREGEX_PBC): $(STAGE0_PBCS) $(STAGE1)/$(HLL_PBC) $(STAGE1)/$(QREGEX_PBC) $(STAGE1)/$(QAST_PBC) $(P6QREGEX_SOURCES)
	$(MKPATH) $(STAGE1)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(P6QREGEX_SOURCES) > $(STAGE1)/$(P6QREGEX_COMBINED)
	$(PARROT) --library=$(STAGE0) $(STAGE0)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE1)/$(P6QREGEX_COMBINED_PIR) \
	    --module-path=$(STAGE1) --setting-path=$(STAGE1) --no-regex-lib \
        $(STAGE1)/$(P6QREGEX_COMBINED)
	$(PARROT) --include=$(STAGE1) -o $(STAGE1)/$(P6QREGEX_PBC) \
	    $(STAGE1)/$(P6QREGEX_COMBINED_PIR)

$(STAGE1)/$(NQP_PBC): $(STAGE0_PBCS) $(STAGE1)/$(CORE_SETTING_PBC) $(STAGE1)/$(P6QREGEX_PBC) $(NQP_SOURCES)
	$(MKPATH) $(STAGE1)/gen
	$(PERL) tools/build/gen-version.pl >src/gen/nqp-config.nqp
	$(PERL) tools/build/gen-cat.pl parrot $(NQP_SOURCES) src/gen/nqp-config.nqp > $(STAGE1)/$(NQP_COMBINED)
	$(PARROT) --library=$(STAGE0) $(STAGE0)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE1)/$(NQP_COMBINED_PIR) \
	    --module-path=$(STAGE1) --setting-path=$(STAGE1) $(STAGE1)/$(NQP_COMBINED)
	$(PARROT) --include=$(STAGE1) -o $(STAGE1)/$(NQP_PBC) \
	    $(STAGE1)/$(NQP_COMBINED_PIR)

$(STAGE2): $(STAGE2_PBCS)

$(STAGE2)/$(NQP_MO_PBC): $(STAGE1_PBCS) $(NQP_MO_SOURCES)
	$(MKPATH) $(STAGE2)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(NQP_MO_SOURCES) > $(STAGE2)/$(NQP_MO_COMBINED)
	$(PARROT) --library=$(STAGE1) $(STAGE1)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE2)/$(NQP_MO_PIR) \
	    --setting=NULL $(STAGE2)/$(NQP_MO_COMBINED)
	$(PARROT) --include=$(STAGE2) -o $(STAGE2)/$(NQP_MO_PBC) \
	    $(STAGE2)/$(NQP_MO_PIR)

$(STAGE2)/$(MODULE_LOADER_PBC): $(STAGE1_PBCS) src/vm/parrot/ModuleLoader.nqp
	$(PARROT) --library=$(STAGE1) $(STAGE1)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE2)/gen/module_loader.pir \
	    --setting=NULL src/vm/parrot/ModuleLoader.nqp
	$(PARROT) --include=$(STAGE2) -o $(STAGE2)/$(MODULE_LOADER_PBC) \
	    $(STAGE2)/gen/module_loader.pir

$(STAGE2)/$(CORE_SETTING_PBC): $(STAGE1_PBCS) $(STAGE2)/$(NQP_MO_PBC) $(STAGE2)/$(MODULE_LOADER_PBC) $(CORE_SETTING_SOURCES)
	$(MKPATH) $(STAGE2)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(CORE_SETTING_SOURCES) > $(STAGE2)/$(CORE_SETTING_NQP)
	$(PARROT) --library=$(STAGE1) $(STAGE1)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE2)/$(CORE_SETTING_PIR) \
	    --module-path=$(STAGE2) --setting=NULL $(STAGE2)/$(CORE_SETTING_NQP)
	$(PARROT) -o $(STAGE2)/$(CORE_SETTING_PBC) $(STAGE2)/$(CORE_SETTING_PIR)

$(STAGE2)/$(QASTNODE_PBC): $(STAGE1_PBCS) $(STAGE2)/$(CORE_SETTING_PBC) $(QASTNODE_SOURCES)
	$(MKPATH) $(STAGE2)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(QASTNODE_SOURCES) > $(STAGE2)/$(QASTNODE_COMBINED)
	$(PARROT) --library=$(STAGE1) $(STAGE1)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE2)/$(QASTNODE_PIR) --no-regex-lib \
	    --module-path=$(STAGE2) --setting-path=$(STAGE2) $(STAGE2)/$(QASTNODE_COMBINED)
	$(PARROT) -o $(STAGE2)/$(QASTNODE_PBC) $(STAGE2)/$(QASTNODE_PIR)

$(STAGE2)/$(QREGEX_PBC): $(STAGE1_PBCS) $(STAGE2)/$(CORE_SETTING_PBC) $(STAGE2)/$(QASTNODE_PBC) $(QREGEX_SOURCES)
	$(MKPATH) $(STAGE2)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(QREGEX_SOURCES) > $(STAGE2)/$(QREGEX_COMBINED)
	$(PARROT) --library=$(STAGE1) $(STAGE1)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE2)/$(QREGEX_PIR) --no-regex-lib \
	    --module-path=$(STAGE2) --setting-path=$(STAGE2) $(STAGE2)/$(QREGEX_COMBINED)
	$(PARROT) -o $(STAGE2)/$(QREGEX_PBC) $(STAGE2)/$(QREGEX_PIR)

$(STAGE2)/$(HLL_PBC): $(STAGE1_PBCS) $(STAGE2)/$(CORE_SETTING_PBC) $(STAGE2)/$(QREGEX_PBC) $(STAGE2)/$(QASTNODE_PBC) $(HLL_SOURCES)
	$(MKPATH) $(STAGE2)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(HLL_SOURCES) > $(STAGE2)/$(HLL_COMBINED)
	$(PARROT) --library=$(STAGE1) $(STAGE1)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE2)/$(HLL_COMBINED_PIR) --no-regex-lib \
	    --module-path=$(STAGE2) --setting-path=$(STAGE2) $(STAGE2)/$(HLL_COMBINED)
	$(PARROT) --include=$(STAGE2) -o $(STAGE2)/$(HLL_PBC) \
	    $(STAGE2)/$(HLL_COMBINED_PIR)

$(STAGE2)/$(QAST_PBC): $(STAGE1_PBCS) $(STAGE2)/$(CORE_SETTING_PBC) $(STAGE2)/$(HLL_PBC) $(QAST_SOURCES)
	$(MKPATH) $(STAGE2)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(QAST_SOURCES) > $(STAGE2)/$(QAST_COMBINED)
	$(PARROT) --library=$(STAGE1) $(STAGE1)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE2)/$(QAST_PIR) --no-regex-lib \
	    --module-path=$(STAGE2) --setting-path=$(STAGE2) $(STAGE2)/$(QAST_COMBINED)
	$(PARROT) -o $(STAGE2)/$(QAST_PBC) $(STAGE2)/$(QAST_PIR)

$(STAGE2)/$(P6QREGEX_PBC): $(STAGE1_PBCS) $(STAGE2)/$(HLL_PBC) $(STAGE2)/$(QAST_PBC) $(P6QREGEX_SOURCES)
	$(MKPATH) $(STAGE2)/gen
	$(PERL) tools/build/gen-cat.pl parrot $(P6QREGEX_SOURCES) > $(STAGE2)/$(P6QREGEX_COMBINED)
	$(PARROT) --library=$(STAGE1) $(STAGE1)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE2)/$(P6QREGEX_COMBINED_PIR) --no-regex-lib \
	    --module-path=$(STAGE2) --setting-path=$(STAGE2) $(STAGE2)/$(P6QREGEX_COMBINED)
	$(PARROT) --include=$(STAGE2) -o $(STAGE2)/$(P6QREGEX_PBC) \
	    $(STAGE2)/$(P6QREGEX_COMBINED_PIR)

$(STAGE2)/$(NQP_PBC): $(STAGE1_PBCS) $(STAGE2)/$(P6QREGEX_PBC) $(NQP_SOURCES)
	$(MKPATH) $(STAGE2)/gen
	$(PERL) tools/build/gen-version.pl >src/gen/nqp-config.nqp
	$(PERL) tools/build/gen-cat.pl parrot $(NQP_SOURCES) src/gen/nqp-config.nqp > $(STAGE2)/$(NQP_COMBINED)
	$(PARROT) --library=$(STAGE1) $(STAGE1)/$(NQP_PBC) \
	    --target=pir --output=$(STAGE2)/$(NQP_COMBINED_PIR) \
	    --module-path=$(STAGE2) --setting-path=$(STAGE2) $(STAGE2)/$(NQP_COMBINED)
	$(PARROT) --include=$(STAGE2) -o $(STAGE2)/$(NQP_PBC) \
	    $(STAGE2)/$(NQP_COMBINED_PIR)

$(ALL_PBCS): $(STAGE2_PBCS)
	$(CP) $(STAGE2)/$(NQP_MO_PBC)           $(PARROT_BUILD_DIR)
	$(CP) $(STAGE2)/$(MODULE_LOADER_PBC)    $(PARROT_BUILD_DIR)
	$(CP) $(STAGE2)/$(CORE_SETTING_PBC)     $(PARROT_BUILD_DIR)
	$(CP) $(STAGE2)/$(QASTNODE_PBC)         $(PARROT_BUILD_DIR)
	$(CP) $(STAGE2)/$(QREGEX_PBC)           $(PARROT_BUILD_DIR)
	$(CP) $(STAGE2)/$(HLL_PBC)              $(PARROT_BUILD_DIR)
	$(CP) $(STAGE2)/$(QAST_PBC)             $(PARROT_BUILD_DIR)
	$(CP) $(STAGE2)/$(P6QREGEX_PBC)         $(PARROT_BUILD_DIR)
	$(CP) $(STAGE2)/$(NQP_PBC)              $(PARROT_BUILD_DIR)

$(PARROT_BUILD_DIR)/$(NQP_EXE): $(PARROT_BUILD_DIR)/$(NQP_PBC) $(PARROT_DLL_COPY)
	cd $(PARROT_BUILD_DIR) && $(PBC_TO_EXE) -o$(NQP_EXE) $(NQP_PBC)

$(P5QREGEX_PBC): $(PARROT_BUILD_DIR)/$(NQP_EXE) $(P5QREGEX_SOURCES)
	$(PERL) tools/build/gen-cat.pl parrot $(P5QREGEX_SOURCES) > $(P5QREGEX_COMBINED)
	$(PARROT) --library=$(PARROT_BUILD_DIR) $(PARROT_BUILD_DIR)/$(NQP_PBC) \
	    --module-path=$(PARROT_BUILD_DIR) --setting-path=$(PARROT_BUILD_DIR) \
		--target=pir --output=$(P5QREGEX_COMBINED_PIR)  $(P5QREGEX_COMBINED)
	$(PARROT) --library=$(PARROT_BUILD_DIR) -o $(P5QREGEX_PBC) $(P5QREGEX_COMBINED_PIR)

@make_dllcopy@

$(DYNEXT_TARGET): $(DYNPMC) $(DYNOPS) $(OPS_DIR)/$(BIGINT_OPS)$(LOAD_EXT) $(OPS_DIR)/$(DYNCALL_OPS)$(LOAD_EXT)
	$(CP) $(DYNPMC) $(DYNEXT_DIR)
	$(CP) $(DYNOPS) $(DYNEXT_DIR)
	$(CP) $(OPS_DIR)/$(BIGINT_OPS)$(LOAD_EXT) $(DYNEXT_DIR)
	$(CP) $(OPS_DIR)/$(DYNCALL_OPS)$(LOAD_EXT) $(DYNEXT_DIR)
	$(CHMOD) 755 $(DYNEXT_TARGET)
	$(CHMOD) 755 $(DYNEXT_DIR)/$(OPS)$(LOAD_EXT)

$(DYNPMC): $(PMC_SOURCES) $(METAMODEL_SOURCE)
	$(PMC2C) --no-lines --dump $(PMC2C_INCLUDES) $(PMC_SOURCES)
	$(PMC2C) --no-lines --c $(PMC2C_INCLUDES) $(PMC_SOURCES)
	$(PMC2C) --no-lines --library $(GROUP) --c $(PMC_SOURCES)
	$(CC) -c @cc_o_out@$(GROUP)$(O) -I$(PMC_DIR) $(CINCLUDES) $(CFLAGS) $(GROUP).c
	cd $(PMC_DIR) && $(CC) -c $(CINCLUDES) -I../../../../3rdparty/libtommath $(CFLAGS) *.c
	$(LD) @ld_out@$(DYNPMC) $(GROUP)$(O) src/vm/parrot/pmc/*$(O) $(LINKARGS)

$(OPS_DIR)/$(OPS)$(LOAD_EXT): $(OPS_DIR)/$(OPS_SOURCE) $(DYNPMC)
	cd $(OPS_DIR) && $(OPS2C) C --dynamic $(OPS_SOURCE)
	cd $(OPS_DIR) && $(CC) -c @cc_o_out@$(OPS)$(O) $(CINCLUDES) $(CFLAGS) $(OPS).c
	cd src/vm/parrot/6model && $(CC) -c @cc_o_out@sixmodelobject$(O) -I../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) sixmodelobject.c
	cd src/vm/parrot/6model && $(CC) -c @cc_o_out@repr_registry$(O) -I../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) repr_registry.c
	cd src/vm/parrot/6model && $(CC) -c @cc_o_out@knowhow_bootstrapper$(O) -I../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) knowhow_bootstrapper.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@KnowHOWREPR$(O) -I../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) KnowHOWREPR.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@P6opaque$(O) -I../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) P6opaque.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@P6int$(O) -I../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) P6int.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@P6str$(O) -I../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) P6str.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@P6num$(O) -I../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) P6num.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@HashAttrStore$(O) -I../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) HashAttrStore.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@Uninstantiable$(O) -I../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) Uninstantiable.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@NFA$(O) -I../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) NFA.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@VMArray$(O) -I../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) VMArray.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@VMHash$(O) -I../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) VMHash.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@VMIter$(O) -I../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) VMIter.c
	cd src/vm/parrot/6model && $(CC) -c @cc_o_out@serialization_context$(O) -I../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) serialization_context.c
	cd src/vm/parrot/6model && $(CC) -c @cc_o_out@serialization$(O) -I../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) serialization.c
	cd src/vm/parrot/6model && $(CC) -c @cc_o_out@base64$(O) -I../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) base64.c
	cd src/vm/parrot/6model && $(CC) -c @cc_o_out@containers$(O) -I../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) containers.c
	cd src/vm/parrot/guts && $(CC) -c @cc_o_out@multi_dispatch$(O) -I../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) multi_dispatch.c
	cd 3rdparty/sha1 && $(CC) -c @cc_o_out@sha1$(O) $(CINCLUDES) $(CFLAGS) sha1.c
	cd $(OPS_DIR) && $(LD) @ld_out@$(OPS)$(LOAD_EXT) $(OPS)$(O) $(METAMODEL_OBJS) ../../../../3rdparty/sha1/sha1$(O) $(LINKARGS)


3rdparty/libtommath/bncore$(O): 3rdparty/libtommath/bncore.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bncore$(O) -I. $(CFLAGS) bncore.c
3rdparty/libtommath/bn_error$(O): 3rdparty/libtommath/bn_error.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_error$(O) -I. $(CFLAGS) bn_error.c
3rdparty/libtommath/bn_fast_mp_invmod$(O): 3rdparty/libtommath/bn_fast_mp_invmod.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_fast_mp_invmod$(O) -I. $(CFLAGS) bn_fast_mp_invmod.c
3rdparty/libtommath/bn_fast_mp_montgomery_reduce$(O): 3rdparty/libtommath/bn_fast_mp_montgomery_reduce.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_fast_mp_montgomery_reduce$(O) -I. $(CFLAGS) bn_fast_mp_montgomery_reduce.c
3rdparty/libtommath/bn_fast_s_mp_mul_digs$(O): 3rdparty/libtommath/bn_fast_s_mp_mul_digs.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_fast_s_mp_mul_digs$(O) -I. $(CFLAGS) bn_fast_s_mp_mul_digs.c
3rdparty/libtommath/bn_fast_s_mp_mul_high_digs$(O): 3rdparty/libtommath/bn_fast_s_mp_mul_high_digs.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_fast_s_mp_mul_high_digs$(O) -I. $(CFLAGS) bn_fast_s_mp_mul_high_digs.c
3rdparty/libtommath/bn_fast_s_mp_sqr$(O): 3rdparty/libtommath/bn_fast_s_mp_sqr.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_fast_s_mp_sqr$(O) -I. $(CFLAGS) bn_fast_s_mp_sqr.c
3rdparty/libtommath/bn_mp_2expt$(O): 3rdparty/libtommath/bn_mp_2expt.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_2expt$(O) -I. $(CFLAGS) bn_mp_2expt.c
3rdparty/libtommath/bn_mp_abs$(O): 3rdparty/libtommath/bn_mp_abs.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_abs$(O) -I. $(CFLAGS) bn_mp_abs.c
3rdparty/libtommath/bn_mp_add$(O): 3rdparty/libtommath/bn_mp_add.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_add$(O) -I. $(CFLAGS) bn_mp_add.c
3rdparty/libtommath/bn_mp_add_d$(O): 3rdparty/libtommath/bn_mp_add_d.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_add_d$(O) -I. $(CFLAGS) bn_mp_add_d.c
3rdparty/libtommath/bn_mp_addmod$(O): 3rdparty/libtommath/bn_mp_addmod.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_addmod$(O) -I. $(CFLAGS) bn_mp_addmod.c
3rdparty/libtommath/bn_mp_and$(O): 3rdparty/libtommath/bn_mp_and.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_and$(O) -I. $(CFLAGS) bn_mp_and.c
3rdparty/libtommath/bn_mp_clamp$(O): 3rdparty/libtommath/bn_mp_clamp.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_clamp$(O) -I. $(CFLAGS) bn_mp_clamp.c
3rdparty/libtommath/bn_mp_clear$(O): 3rdparty/libtommath/bn_mp_clear.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_clear$(O) -I. $(CFLAGS) bn_mp_clear.c
3rdparty/libtommath/bn_mp_clear_multi$(O): 3rdparty/libtommath/bn_mp_clear_multi.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_clear_multi$(O) -I. $(CFLAGS) bn_mp_clear_multi.c
3rdparty/libtommath/bn_mp_cmp$(O): 3rdparty/libtommath/bn_mp_cmp.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_cmp$(O) -I. $(CFLAGS) bn_mp_cmp.c
3rdparty/libtommath/bn_mp_cmp_d$(O): 3rdparty/libtommath/bn_mp_cmp_d.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_cmp_d$(O) -I. $(CFLAGS) bn_mp_cmp_d.c
3rdparty/libtommath/bn_mp_cmp_mag$(O): 3rdparty/libtommath/bn_mp_cmp_mag.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_cmp_mag$(O) -I. $(CFLAGS) bn_mp_cmp_mag.c
3rdparty/libtommath/bn_mp_cnt_lsb$(O): 3rdparty/libtommath/bn_mp_cnt_lsb.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_cnt_lsb$(O) -I. $(CFLAGS) bn_mp_cnt_lsb.c
3rdparty/libtommath/bn_mp_copy$(O): 3rdparty/libtommath/bn_mp_copy.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_copy$(O) -I. $(CFLAGS) bn_mp_copy.c
3rdparty/libtommath/bn_mp_count_bits$(O): 3rdparty/libtommath/bn_mp_count_bits.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_count_bits$(O) -I. $(CFLAGS) bn_mp_count_bits.c
3rdparty/libtommath/bn_mp_div_2$(O): 3rdparty/libtommath/bn_mp_div_2.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_div_2$(O) -I. $(CFLAGS) bn_mp_div_2.c
3rdparty/libtommath/bn_mp_div_2d$(O): 3rdparty/libtommath/bn_mp_div_2d.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_div_2d$(O) -I. $(CFLAGS) bn_mp_div_2d.c
3rdparty/libtommath/bn_mp_div_3$(O): 3rdparty/libtommath/bn_mp_div_3.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_div_3$(O) -I. $(CFLAGS) bn_mp_div_3.c
3rdparty/libtommath/bn_mp_div$(O): 3rdparty/libtommath/bn_mp_div.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_div$(O) -I. $(CFLAGS) bn_mp_div.c
3rdparty/libtommath/bn_mp_div_d$(O): 3rdparty/libtommath/bn_mp_div_d.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_div_d$(O) -I. $(CFLAGS) bn_mp_div_d.c
3rdparty/libtommath/bn_mp_dr_is_modulus$(O): 3rdparty/libtommath/bn_mp_dr_is_modulus.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_dr_is_modulus$(O) -I. $(CFLAGS) bn_mp_dr_is_modulus.c
3rdparty/libtommath/bn_mp_dr_reduce$(O): 3rdparty/libtommath/bn_mp_dr_reduce.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_dr_reduce$(O) -I. $(CFLAGS) bn_mp_dr_reduce.c
3rdparty/libtommath/bn_mp_dr_setup$(O): 3rdparty/libtommath/bn_mp_dr_setup.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_dr_setup$(O) -I. $(CFLAGS) bn_mp_dr_setup.c
3rdparty/libtommath/bn_mp_exch$(O): 3rdparty/libtommath/bn_mp_exch.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_exch$(O) -I. $(CFLAGS) bn_mp_exch.c
3rdparty/libtommath/bn_mp_expt_d$(O): 3rdparty/libtommath/bn_mp_expt_d.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_expt_d$(O) -I. $(CFLAGS) bn_mp_expt_d.c
3rdparty/libtommath/bn_mp_exptmod$(O): 3rdparty/libtommath/bn_mp_exptmod.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_exptmod$(O) -I. $(CFLAGS) bn_mp_exptmod.c
3rdparty/libtommath/bn_mp_exptmod_fast$(O): 3rdparty/libtommath/bn_mp_exptmod_fast.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_exptmod_fast$(O) -I. $(CFLAGS) bn_mp_exptmod_fast.c
3rdparty/libtommath/bn_mp_exteuclid$(O): 3rdparty/libtommath/bn_mp_exteuclid.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_exteuclid$(O) -I. $(CFLAGS) bn_mp_exteuclid.c
3rdparty/libtommath/bn_mp_fread$(O): 3rdparty/libtommath/bn_mp_fread.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_fread$(O) -I. $(CFLAGS) bn_mp_fread.c
3rdparty/libtommath/bn_mp_fwrite$(O): 3rdparty/libtommath/bn_mp_fwrite.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_fwrite$(O) -I. $(CFLAGS) bn_mp_fwrite.c
3rdparty/libtommath/bn_mp_gcd$(O): 3rdparty/libtommath/bn_mp_gcd.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_gcd$(O) -I. $(CFLAGS) bn_mp_gcd.c
3rdparty/libtommath/bn_mp_get_int$(O): 3rdparty/libtommath/bn_mp_get_int.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_get_int$(O) -I. $(CFLAGS) bn_mp_get_int.c
3rdparty/libtommath/bn_mp_get_long$(O): 3rdparty/libtommath/bn_mp_get_long.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_get_long$(O) -I. $(CFLAGS) bn_mp_get_long.c
3rdparty/libtommath/bn_mp_grow$(O): 3rdparty/libtommath/bn_mp_grow.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_grow$(O) -I. $(CFLAGS) bn_mp_grow.c
3rdparty/libtommath/bn_mp_init$(O): 3rdparty/libtommath/bn_mp_init.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_init$(O) -I. $(CFLAGS) bn_mp_init.c
3rdparty/libtommath/bn_mp_init_copy$(O): 3rdparty/libtommath/bn_mp_init_copy.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_init_copy$(O) -I. $(CFLAGS) bn_mp_init_copy.c
3rdparty/libtommath/bn_mp_init_multi$(O): 3rdparty/libtommath/bn_mp_init_multi.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_init_multi$(O) -I. $(CFLAGS) bn_mp_init_multi.c
3rdparty/libtommath/bn_mp_init_set$(O): 3rdparty/libtommath/bn_mp_init_set.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_init_set$(O) -I. $(CFLAGS) bn_mp_init_set.c
3rdparty/libtommath/bn_mp_init_set_int$(O): 3rdparty/libtommath/bn_mp_init_set_int.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_init_set_int$(O) -I. $(CFLAGS) bn_mp_init_set_int.c
3rdparty/libtommath/bn_mp_init_size$(O): 3rdparty/libtommath/bn_mp_init_size.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_init_size$(O) -I. $(CFLAGS) bn_mp_init_size.c
3rdparty/libtommath/bn_mp_invmod$(O): 3rdparty/libtommath/bn_mp_invmod.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_invmod$(O) -I. $(CFLAGS) bn_mp_invmod.c
3rdparty/libtommath/bn_mp_invmod_slow$(O): 3rdparty/libtommath/bn_mp_invmod_slow.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_invmod_slow$(O) -I. $(CFLAGS) bn_mp_invmod_slow.c
3rdparty/libtommath/bn_mp_is_square$(O): 3rdparty/libtommath/bn_mp_is_square.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_is_square$(O) -I. $(CFLAGS) bn_mp_is_square.c
3rdparty/libtommath/bn_mp_jacobi$(O): 3rdparty/libtommath/bn_mp_jacobi.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_jacobi$(O) -I. $(CFLAGS) bn_mp_jacobi.c
3rdparty/libtommath/bn_mp_karatsuba_mul$(O): 3rdparty/libtommath/bn_mp_karatsuba_mul.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_karatsuba_mul$(O) -I. $(CFLAGS) bn_mp_karatsuba_mul.c
3rdparty/libtommath/bn_mp_karatsuba_sqr$(O): 3rdparty/libtommath/bn_mp_karatsuba_sqr.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_karatsuba_sqr$(O) -I. $(CFLAGS) bn_mp_karatsuba_sqr.c
3rdparty/libtommath/bn_mp_lcm$(O): 3rdparty/libtommath/bn_mp_lcm.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_lcm$(O) -I. $(CFLAGS) bn_mp_lcm.c
3rdparty/libtommath/bn_mp_lshd$(O): 3rdparty/libtommath/bn_mp_lshd.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_lshd$(O) -I. $(CFLAGS) bn_mp_lshd.c
3rdparty/libtommath/bn_mp_mod_2d$(O): 3rdparty/libtommath/bn_mp_mod_2d.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_mod_2d$(O) -I. $(CFLAGS) bn_mp_mod_2d.c
3rdparty/libtommath/bn_mp_mod$(O): 3rdparty/libtommath/bn_mp_mod.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_mod$(O) -I. $(CFLAGS) bn_mp_mod.c
3rdparty/libtommath/bn_mp_mod_d$(O): 3rdparty/libtommath/bn_mp_mod_d.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_mod_d$(O) -I. $(CFLAGS) bn_mp_mod_d.c
3rdparty/libtommath/bn_mp_montgomery_calc_normalization$(O): 3rdparty/libtommath/bn_mp_montgomery_calc_normalization.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_montgomery_calc_normalization$(O) -I. $(CFLAGS) bn_mp_montgomery_calc_normalization.c
3rdparty/libtommath/bn_mp_montgomery_reduce$(O): 3rdparty/libtommath/bn_mp_montgomery_reduce.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_montgomery_reduce$(O) -I. $(CFLAGS) bn_mp_montgomery_reduce.c
3rdparty/libtommath/bn_mp_montgomery_setup$(O): 3rdparty/libtommath/bn_mp_montgomery_setup.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_montgomery_setup$(O) -I. $(CFLAGS) bn_mp_montgomery_setup.c
3rdparty/libtommath/bn_mp_mul_2$(O): 3rdparty/libtommath/bn_mp_mul_2.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_mul_2$(O) -I. $(CFLAGS) bn_mp_mul_2.c
3rdparty/libtommath/bn_mp_mul_2d$(O): 3rdparty/libtommath/bn_mp_mul_2d.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_mul_2d$(O) -I. $(CFLAGS) bn_mp_mul_2d.c
3rdparty/libtommath/bn_mp_mul$(O): 3rdparty/libtommath/bn_mp_mul.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_mul$(O) -I. $(CFLAGS) bn_mp_mul.c
3rdparty/libtommath/bn_mp_mul_d$(O): 3rdparty/libtommath/bn_mp_mul_d.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_mul_d$(O) -I. $(CFLAGS) bn_mp_mul_d.c
3rdparty/libtommath/bn_mp_mulmod$(O): 3rdparty/libtommath/bn_mp_mulmod.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_mulmod$(O) -I. $(CFLAGS) bn_mp_mulmod.c
3rdparty/libtommath/bn_mp_neg$(O): 3rdparty/libtommath/bn_mp_neg.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_neg$(O) -I. $(CFLAGS) bn_mp_neg.c
3rdparty/libtommath/bn_mp_n_root$(O): 3rdparty/libtommath/bn_mp_n_root.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_n_root$(O) -I. $(CFLAGS) bn_mp_n_root.c
3rdparty/libtommath/bn_mp_or$(O): 3rdparty/libtommath/bn_mp_or.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_or$(O) -I. $(CFLAGS) bn_mp_or.c
3rdparty/libtommath/bn_mp_prime_fermat$(O): 3rdparty/libtommath/bn_mp_prime_fermat.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_prime_fermat$(O) -I. $(CFLAGS) bn_mp_prime_fermat.c
3rdparty/libtommath/bn_mp_prime_is_divisible$(O): 3rdparty/libtommath/bn_mp_prime_is_divisible.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_prime_is_divisible$(O) -I. $(CFLAGS) bn_mp_prime_is_divisible.c
3rdparty/libtommath/bn_mp_prime_is_prime$(O): 3rdparty/libtommath/bn_mp_prime_is_prime.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_prime_is_prime$(O) -I. $(CFLAGS) bn_mp_prime_is_prime.c
3rdparty/libtommath/bn_mp_prime_miller_rabin$(O): 3rdparty/libtommath/bn_mp_prime_miller_rabin.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_prime_miller_rabin$(O) -I. $(CFLAGS) bn_mp_prime_miller_rabin.c
3rdparty/libtommath/bn_mp_prime_next_prime$(O): 3rdparty/libtommath/bn_mp_prime_next_prime.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_prime_next_prime$(O) -I. $(CFLAGS) bn_mp_prime_next_prime.c
3rdparty/libtommath/bn_mp_prime_rabin_miller_trials$(O): 3rdparty/libtommath/bn_mp_prime_rabin_miller_trials.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_prime_rabin_miller_trials$(O) -I. $(CFLAGS) bn_mp_prime_rabin_miller_trials.c
3rdparty/libtommath/bn_mp_prime_random_ex$(O): 3rdparty/libtommath/bn_mp_prime_random_ex.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_prime_random_ex$(O) -I. $(CFLAGS) bn_mp_prime_random_ex.c
3rdparty/libtommath/bn_mp_radix_size$(O): 3rdparty/libtommath/bn_mp_radix_size.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_radix_size$(O) -I. $(CFLAGS) bn_mp_radix_size.c
3rdparty/libtommath/bn_mp_radix_smap$(O): 3rdparty/libtommath/bn_mp_radix_smap.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_radix_smap$(O) -I. $(CFLAGS) bn_mp_radix_smap.c
3rdparty/libtommath/bn_mp_rand$(O): 3rdparty/libtommath/bn_mp_rand.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_rand$(O) -I. $(CFLAGS) bn_mp_rand.c
3rdparty/libtommath/bn_mp_read_radix$(O): 3rdparty/libtommath/bn_mp_read_radix.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_read_radix$(O) -I. $(CFLAGS) bn_mp_read_radix.c
3rdparty/libtommath/bn_mp_read_signed_bin$(O): 3rdparty/libtommath/bn_mp_read_signed_bin.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_read_signed_bin$(O) -I. $(CFLAGS) bn_mp_read_signed_bin.c
3rdparty/libtommath/bn_mp_read_unsigned_bin$(O): 3rdparty/libtommath/bn_mp_read_unsigned_bin.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_read_unsigned_bin$(O) -I. $(CFLAGS) bn_mp_read_unsigned_bin.c
3rdparty/libtommath/bn_mp_reduce_2k$(O): 3rdparty/libtommath/bn_mp_reduce_2k.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_reduce_2k$(O) -I. $(CFLAGS) bn_mp_reduce_2k.c
3rdparty/libtommath/bn_mp_reduce_2k_l$(O): 3rdparty/libtommath/bn_mp_reduce_2k_l.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_reduce_2k_l$(O) -I. $(CFLAGS) bn_mp_reduce_2k_l.c
3rdparty/libtommath/bn_mp_reduce_2k_setup$(O): 3rdparty/libtommath/bn_mp_reduce_2k_setup.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_reduce_2k_setup$(O) -I. $(CFLAGS) bn_mp_reduce_2k_setup.c
3rdparty/libtommath/bn_mp_reduce_2k_setup_l$(O): 3rdparty/libtommath/bn_mp_reduce_2k_setup_l.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_reduce_2k_setup_l$(O) -I. $(CFLAGS) bn_mp_reduce_2k_setup_l.c
3rdparty/libtommath/bn_mp_reduce$(O): 3rdparty/libtommath/bn_mp_reduce.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_reduce$(O) -I. $(CFLAGS) bn_mp_reduce.c
3rdparty/libtommath/bn_mp_reduce_is_2k$(O): 3rdparty/libtommath/bn_mp_reduce_is_2k.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_reduce_is_2k$(O) -I. $(CFLAGS) bn_mp_reduce_is_2k.c
3rdparty/libtommath/bn_mp_reduce_is_2k_l$(O): 3rdparty/libtommath/bn_mp_reduce_is_2k_l.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_reduce_is_2k_l$(O) -I. $(CFLAGS) bn_mp_reduce_is_2k_l.c
3rdparty/libtommath/bn_mp_reduce_setup$(O): 3rdparty/libtommath/bn_mp_reduce_setup.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_reduce_setup$(O) -I. $(CFLAGS) bn_mp_reduce_setup.c
3rdparty/libtommath/bn_mp_rshd$(O): 3rdparty/libtommath/bn_mp_rshd.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_rshd$(O) -I. $(CFLAGS) bn_mp_rshd.c
3rdparty/libtommath/bn_mp_set$(O): 3rdparty/libtommath/bn_mp_set.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_set$(O) -I. $(CFLAGS) bn_mp_set.c
3rdparty/libtommath/bn_mp_set_int$(O): 3rdparty/libtommath/bn_mp_set_int.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_set_int$(O) -I. $(CFLAGS) bn_mp_set_int.c
3rdparty/libtommath/bn_mp_set_long$(O): 3rdparty/libtommath/bn_mp_set_long.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_set_long$(O) -I. $(CFLAGS) bn_mp_set_long.c
3rdparty/libtommath/bn_mp_shrink$(O): 3rdparty/libtommath/bn_mp_shrink.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_shrink$(O) -I. $(CFLAGS) bn_mp_shrink.c
3rdparty/libtommath/bn_mp_signed_bin_size$(O): 3rdparty/libtommath/bn_mp_signed_bin_size.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_signed_bin_size$(O) -I. $(CFLAGS) bn_mp_signed_bin_size.c
3rdparty/libtommath/bn_mp_sqr$(O): 3rdparty/libtommath/bn_mp_sqr.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_sqr$(O) -I. $(CFLAGS) bn_mp_sqr.c
3rdparty/libtommath/bn_mp_sqrmod$(O): 3rdparty/libtommath/bn_mp_sqrmod.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_sqrmod$(O) -I. $(CFLAGS) bn_mp_sqrmod.c
3rdparty/libtommath/bn_mp_sqrt$(O): 3rdparty/libtommath/bn_mp_sqrt.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_sqrt$(O) -I. $(CFLAGS) bn_mp_sqrt.c
3rdparty/libtommath/bn_mp_sub$(O): 3rdparty/libtommath/bn_mp_sub.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_sub$(O) -I. $(CFLAGS) bn_mp_sub.c
3rdparty/libtommath/bn_mp_sub_d$(O): 3rdparty/libtommath/bn_mp_sub_d.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_sub_d$(O) -I. $(CFLAGS) bn_mp_sub_d.c
3rdparty/libtommath/bn_mp_submod$(O): 3rdparty/libtommath/bn_mp_submod.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_submod$(O) -I. $(CFLAGS) bn_mp_submod.c
3rdparty/libtommath/bn_mp_toom_mul$(O): 3rdparty/libtommath/bn_mp_toom_mul.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_toom_mul$(O) -I. $(CFLAGS) bn_mp_toom_mul.c
3rdparty/libtommath/bn_mp_toom_sqr$(O): 3rdparty/libtommath/bn_mp_toom_sqr.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_toom_sqr$(O) -I. $(CFLAGS) bn_mp_toom_sqr.c
3rdparty/libtommath/bn_mp_toradix$(O): 3rdparty/libtommath/bn_mp_toradix.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_toradix$(O) -I. $(CFLAGS) bn_mp_toradix.c
3rdparty/libtommath/bn_mp_toradix_n$(O): 3rdparty/libtommath/bn_mp_toradix_n.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_toradix_n$(O) -I. $(CFLAGS) bn_mp_toradix_n.c
3rdparty/libtommath/bn_mp_to_signed_bin$(O): 3rdparty/libtommath/bn_mp_to_signed_bin.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_to_signed_bin$(O) -I. $(CFLAGS) bn_mp_to_signed_bin.c
3rdparty/libtommath/bn_mp_to_signed_bin_n$(O): 3rdparty/libtommath/bn_mp_to_signed_bin_n.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_to_signed_bin_n$(O) -I. $(CFLAGS) bn_mp_to_signed_bin_n.c
3rdparty/libtommath/bn_mp_to_unsigned_bin$(O): 3rdparty/libtommath/bn_mp_to_unsigned_bin.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_to_unsigned_bin$(O) -I. $(CFLAGS) bn_mp_to_unsigned_bin.c
3rdparty/libtommath/bn_mp_to_unsigned_bin_n$(O): 3rdparty/libtommath/bn_mp_to_unsigned_bin_n.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_to_unsigned_bin_n$(O) -I. $(CFLAGS) bn_mp_to_unsigned_bin_n.c
3rdparty/libtommath/bn_mp_unsigned_bin_size$(O): 3rdparty/libtommath/bn_mp_unsigned_bin_size.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_unsigned_bin_size$(O) -I. $(CFLAGS) bn_mp_unsigned_bin_size.c
3rdparty/libtommath/bn_mp_xor$(O): 3rdparty/libtommath/bn_mp_xor.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_xor$(O) -I. $(CFLAGS) bn_mp_xor.c
3rdparty/libtommath/bn_mp_zero$(O): 3rdparty/libtommath/bn_mp_zero.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_mp_zero$(O) -I. $(CFLAGS) bn_mp_zero.c
3rdparty/libtommath/bn_prime_tab$(O): 3rdparty/libtommath/bn_prime_tab.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_prime_tab$(O) -I. $(CFLAGS) bn_prime_tab.c
3rdparty/libtommath/bn_reverse$(O): 3rdparty/libtommath/bn_reverse.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_reverse$(O) -I. $(CFLAGS) bn_reverse.c
3rdparty/libtommath/bn_s_mp_add$(O): 3rdparty/libtommath/bn_s_mp_add.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_s_mp_add$(O) -I. $(CFLAGS) bn_s_mp_add.c
3rdparty/libtommath/bn_s_mp_exptmod$(O): 3rdparty/libtommath/bn_s_mp_exptmod.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_s_mp_exptmod$(O) -I. $(CFLAGS) bn_s_mp_exptmod.c
3rdparty/libtommath/bn_s_mp_mul_digs$(O): 3rdparty/libtommath/bn_s_mp_mul_digs.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_s_mp_mul_digs$(O) -I. $(CFLAGS) bn_s_mp_mul_digs.c
3rdparty/libtommath/bn_s_mp_mul_high_digs$(O): 3rdparty/libtommath/bn_s_mp_mul_high_digs.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_s_mp_mul_high_digs$(O) -I. $(CFLAGS) bn_s_mp_mul_high_digs.c
3rdparty/libtommath/bn_s_mp_sqr$(O): 3rdparty/libtommath/bn_s_mp_sqr.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_s_mp_sqr$(O) -I. $(CFLAGS) bn_s_mp_sqr.c
3rdparty/libtommath/bn_s_mp_sub$(O): 3rdparty/libtommath/bn_s_mp_sub.c $(LIBTOMMATH_H)
	cd 3rdparty/libtommath && $(CC) -c @cc_o_out@bn_s_mp_sub$(O) -I. $(CFLAGS) bn_s_mp_sub.c

$(OPS_DIR)/$(BIGINT_OPS)$(LOAD_EXT): $(OPS_DIR)/$(BIGINT_OPS_SOURCE) $(LIBTOMMATH_BIN) $(LIBTOMMATH_H) src/vm/parrot/6model/reprs/P6bigint.h src/vm/parrot/6model/reprs/P6bigint.c
	cd $(OPS_DIR) && $(OPS2C) C --dynamic $(BIGINT_OPS_SOURCE)
	cd $(OPS_DIR) && $(CC) -c @cc_o_out@$(BIGINT_OPS)$(O) $(CINCLUDES) -I../../../../3rdparty/libtommath $(CFLAGS) $(BIGINT_OPS).c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@P6bigint$(O) -I../../../../../../$(PMC_DIR) -I../../../../../3rdparty/libtommath $(CINCLUDES) $(CFLAGS) P6bigint.c
	cd $(OPS_DIR) && $(LD) @ld_out@$(BIGINT_OPS)$(LOAD_EXT) $(BIGINT_OPS)$(O) ../../../../3rdparty/libtommath/*$(O) ../6model/reprs/P6bigint$(O) $(LINKARGS)

$(DYNCALL_BIN):
	@dyncall_build@

$(OPS_DIR)/$(DYNCALL_OPS)$(LOAD_EXT): $(OPS_DIR)/$(DYNCALL_OPS_SOURCE) $(DYNCALL_BIN) src/vm/parrot/6model/reprs/NativeCall.c src/vm/parrot/6model/reprs/NativeCall.h src/vm/parrot/6model/reprs/CStruct.c src/vm/parrot/6model/reprs/CStruct.h src/vm/parrot/6model/reprs/CPointer.c src/vm/parrot/6model/reprs/CPointer.h src/vm/parrot/6model/reprs/CArray.c src/vm/parrot/6model/reprs/CArray.h src/vm/parrot/6model/reprs/CStr.c src/vm/parrot/6model/reprs/CStr.h
	cd $(OPS_DIR) && $(OPS2C) C --dynamic $(DYNCALL_OPS_SOURCE)
	cd $(OPS_DIR) && $(CC) -c @cc_o_out@$(DYNCALL_OPS)$(O) $(CINCLUDES) -I../../../../3rdparty/dyncall/dyncall -I../../../../3rdparty/dyncall/dyncallback -I../../../../3rdparty/dyncall/dynload $(CFLAGS) $(DYNCALL_OPS).c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@NativeCall$(O) -I../../../../../../../$(PMC_DIR) -I../../../../../3rdparty/dyncall/dyncall -I../../../../../3rdparty/dyncall/dyncallback -I../../../../../3rdparty/dyncall/dynload $(CINCLUDES) $(CFLAGS) NativeCall.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@CStruct$(O) -I../../../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) CStruct.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@CPointer$(O) -I../../../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) CPointer.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@CArray$(O) -I../../../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) CArray.c
	cd src/vm/parrot/6model/reprs && $(CC) -c @cc_o_out@CStr$(O) -I../../../../../../../$(PMC_DIR) $(CINCLUDES) $(CFLAGS) CStr.c
	cd $(OPS_DIR) && $(LD) @ld_out@$(DYNCALL_OPS)$(LOAD_EXT) $(DYNCALL_OPS)$(O) ../6model/reprs/NativeCall$(O) ../6model/reprs/CStruct$(O) ../6model/reprs/CPointer$(O) ../6model/reprs/CArray$(O) ../6model/reprs/CStr$(O) ../../../../3rdparty/dyncall/dyncall/libdyncall_s$(A) ../../../../3rdparty/dyncall/dyncallback/libdyncallback_s$(A) ../../../../3rdparty/dyncall/dynload/libdynload_s$(A) $(LINKARGS)

$(NQP_CONST_PIR):
	perl tools/build/generate-constants.pl > $@

bootstrap-files: $(STAGE2_PBCS) src/stage2/$(CORE_SETTING_NQP)
	$(PERL) tools/build/gen-bootstrap.pl src/stage2/$(NQP_MO_PIR) >src/vm/parrot/stage0/NQPMO-s0.pir
	$(PERL) tools/build/gen-bootstrap.pl src/stage2/gen/module_loader.pir >src/vm/parrot/stage0/ModuleLoader-s0.pir
	$(PERL) tools/build/gen-bootstrap.pl src/stage2/$(CORE_SETTING_PIR) >src/vm/parrot/stage0/NQPCORE.setting-s0.pir
	$(PERL) tools/build/gen-bootstrap.pl src/stage2/$(QASTNODE_PIR) >src/vm/parrot/stage0/QASTNode-s0.pir
	$(PERL) tools/build/gen-bootstrap.pl src/stage2/$(QREGEX_PIR) >src/vm/parrot/stage0/QRegex-s0.pir
	$(PERL) tools/build/gen-bootstrap.pl src/stage2/$(HLL_COMBINED_PIR) >src/vm/parrot/stage0/HLL-s0.pir
	$(PERL) tools/build/gen-bootstrap.pl src/stage2/$(QAST_PIR) >src/vm/parrot/stage0/QAST-s0.pir
	$(PERL) tools/build/gen-bootstrap.pl src/stage2/$(P6QREGEX_COMBINED_PIR) >src/vm/parrot/stage0/P6QRegex-s0.pir
	$(PERL) tools/build/gen-bootstrap.pl src/stage2/$(NQP_COMBINED_PIR) >src/vm/parrot/stage0/NQP-s0.pir

## testing

t/*/*.t: all
	prove -r -v --exec $(PARROT_BUILD_DIR)/$(NQP_EXE) $@

test: all
	prove -r --exec "$(PARROT_BUILD_DIR)/$(NQP_EXE) --vmlibs=nqp_dyncall_ops" t/nqp t/parrot t/hll t/qregex t/p5regex t/qast t/serialization t/nativecall

test-loud: all
	prove -r -v --exec "$(PARROT_BUILD_DIR)/$(NQP_EXE) --vmlibs=nqp_dyncall_ops" t/nqp t/parrot t/hll t/qregex t/p5regex t/qast t/serialization t/nativecall

core-test: $(PARROT_BUILD_DIR)/$(NQP_EXE)
	prove -r --exec $(PARROT_BUILD_DIR)/$(NQP_EXE) t/nqp t/parrot

core-test-loud: $(PARROT_BUILD_DIR)/$(NQP_EXE)
	prove -r -v --exec $(PARROT_BUILD_DIR)/$(NQP_EXE) t/nqp t/parrot

qregex-test: $(PARROT_BUILD_DIR)/$(NQP_EXE)
	prove -r --exec $(PARROT_BUILD_DIR)/$(NQP_EXE) t/qregex

qregex-test-loud: $(PARROT_BUILD_DIR)/$(NQP_EXE)
	prove -r -v --exec ./$(NQP_EXE) t/qregex

## cleaning

clean:
	$(RM_F) $(CLEANUPS)

distclean: realclean

realclean: clean
	$(RM_F) Makefile

testclean:

manifest:
	echo MANIFEST >MANIFEST
	git ls-files >>MANIFEST

release: manifest
	[ -n "$(VERSION)" ] || ( echo "\nTry 'make release VERSION=yyyy.mm'\n\n"; exit 1 )
	[ -d nqp-$(VERSION) ] || ln -s . nqp-$(VERSION)
	$(PERL) -ne 'print "nqp-$(VERSION)/$$_"' MANIFEST |\
	    tar -zcv -T - -f nqp-$(VERSION).tar.gz
	rm nqp-$(VERSION)

# nqp::makefile <-- tells Configure.pm to convert / to \ in the above
#                   template for Win32 systems
